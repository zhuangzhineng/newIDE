"use strict";function customMenu(e){var n=$("#projectCodeTree").jstree(!0),t={create_js:{label:"Create JS",action:function(t){$("#createModal").modal(),e=n.create_node(e),n.edit(e),console.log("to create file")}},create_api:{label:"Create API",action:function(e){console.log("to create file")}},create_folder:{label:"Create Folder",action:function(e){console.log("to create folder")}},rename:{label:"Rename",action:function(){n.edit(e),console.log("to rename")}},"delete":{label:"Delete",action:function(){n.delete_node(e),console.log("to delete")}}};return $(e).hasClass("folder")&&delete t["delete"],t}function getParameterByName(e,n){n||(n=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=t.exec(n);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}function initFileTree(){var e=getParameterByName("appId"),n=getParameterByName("accessToken"),t=getParameterByName("appType");Common.saveAppid(e),Common.saveAccessToken(n),Common.saveAppType(t),Services.getUserInfo(function(e){console.log("getUserInfo success:"+JSON.stringify(e)),Common.saveUserName(e.name)},function(e){console.error("getUserInfo fail. because:"+JSON.stringify(e))}),$("#projectCodeTree").jstree({core:{animation:0,check_callback:!0,data:{url:"api/fileList",data:function(t){var o=this.get_path(t,"/");return{accessToken:n,appid:e,path:o||""}},dataFilter:function(e,n){return dataTransfer(JSON.parse(e))}}},plugins:["contextmenu","dnd","search","conditionalselect","state","types","wholerow"],conditionalselect:function(e){return this.is_leaf(e)},contextmenu:{items:customMenu}}).bind("select_node.jstree",function(e,n){var t=n.instance.get_path(n.node,"/");selectNodePath=t,openFile(t)}).on("delete_node.jstree",function(e,n){var t=n.instance.get_path(n.node,"/");Services.deleteFile(t,function(){console.log("delete success.")},function(e){console.error("delete fail. because:"+e),n.instance.refresh()})}).on("create_node.jstree",function(e,n){var t=n.instance.get_path(n.node,"/");createHandler(t,n)}).on("rename_node.jstree",function(e,n){var t=n.instance.get_path(n.node,"/"),o=t.substring(0,t.lastIndexOf("/"))+"/"+n.old;Services.renameFile(o,t,function(e){console.log("rename success.")},function(e){console.error("rename file fail. because:"+e),n.instance.refresh()})})}function createHandler(e,n){e&&(0===e.indexOf("api")?Services.createAPI(n.node.text,null,function(e){console.log("create API success.")},function(e){console.error("create API fail. because:"+e),n.instance.refresh()}):0===e.indexOf("app")&&Services.createFile(e,function(e){console.log("create success.")},function(e){console.error("create file fail. because:"+e),n.instance.refresh()}))}function dataTransfer(e){return $.map(e,function(e){var n,t,o=e.name;return o.indexOf(".")<-1?(n="folder",t="jstree-folder"):o.indexOf(".png")>0||o.indexOf(".jpg")>0?(n="image",t="fa fa-file-image-o"):(n="code",t="fa fa-code"),{text:o,children:1==e.dir,icon:t,type:n}})}function initCodeContainer(){codeEditContainer=new TabContainer({targetId:"contentArea"})}function openFile(e){var n,t=e.replace(/\//g,"_").replace(/\./g,"_").replace(/\s/g,"_"),o=codeEditContainer.findTab(t);if(o)n=o.getData("editor"),codeEditContainer.active(t);else{var i=codeEditContainer.addTab({tabTitle:e,id:t});n=initEditor({target:$("#codeArea"+i.id)[0]}),i.setData("editor",n),initEditorHeader({dom:$("#toolbar"+i.id)[0],editor:n})}Services.getFileContent(e,function(e){console.log(e),n.setValue(String(e),1)},function(e){console.error(e)}),n.isFirstInit=!0}function initEditor(e){var n=ace.require("ace/ext/language_tools"),t=ace.edit(e.target);t.setTheme("ace/theme/monokai"),t.getSession().setMode("ace/mode/javascript"),t.renderer.setShowPrintMargin(!1),t.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,wrap:"free"}),t.on("input",function(){return t.isFirstInit?void(t.isFirstInit=!1):void saveFile(t.getValue())});var o={getCompletions:function(e,n,t,o,i){var a=[{name:"myname",value:"enterValue",score:"mysocre",meta:"popMeta"}];return 0===o.length?void i(null,[]):void i(null,a)}};return n.addCompleter(o),t}function saveFile(e){Services.saveFile(selectNodePath,e,function(e){console.log("save success")},function(e){return console.error(e)})}function initEditorHeader(e){$('[name="saveButton"]',e.dom).on("click",function(n){saveFile(e.getValue())})}function run(){if(console.log("start running:"+selectNodePath),selectNodePath.startsWith("api")){previewWin&&!previewWin.closed&&previewWin.close();var e=selectNodePath.substring(4,selectNodePath.indexOf(".")),n="hotapi/"+Common.getUserName()+"/"+Common.getAppid()+"/"+e;previewWin=window.open(n,"_blank"),previewWin.focus()}else alert("Currently we only support API preview. Please open one of your js file under 'api' folder and press run again")}var $__Services_46_js__,$__views_47_widgets_47_TabContainer_46_js__,$__common_46_js__,Services=($__Services_46_js__=require("./Services.js"),$__Services_46_js__&&$__Services_46_js__.__esModule&&$__Services_46_js__||{"default":$__Services_46_js__})["default"],TabContainer=($__views_47_widgets_47_TabContainer_46_js__=require("./views/widgets/TabContainer.js"),$__views_47_widgets_47_TabContainer_46_js__&&$__views_47_widgets_47_TabContainer_46_js__.__esModule&&$__views_47_widgets_47_TabContainer_46_js__||{"default":$__views_47_widgets_47_TabContainer_46_js__})["default"],Common=($__common_46_js__=require("./common.js"),$__common_46_js__&&$__common_46_js__.__esModule&&$__common_46_js__||{"default":$__common_46_js__})["default"],selectNodePath;$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(e){var n=e.target;selectNodePath=n.innerText});var codeEditContainer,previewWin;Object.defineProperties(module.exports,{initFileTree:{get:function(){return initFileTree}},initCodeContainer:{get:function(){return initCodeContainer}},run:{get:function(){return run}},__esModule:{value:!0}});